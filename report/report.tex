\documentclass[twocolumn]{article}
\usepackage{amsmath}
\pagestyle{empty}
\setlength{\textwidth}{7in}
\setlength{\textheight}{9.125in}
\setlength{\columnsep}{0.5in}
\setlength{\topmargin}{-0.8in}
\setlength{\oddsidemargin}{-0.25in}
\setlength{\parindent}{5 ex}

\makeatletter
\def\@normalsize{\@setsize\normalsize{12pt}\xpt\@xpt \abovedisplayskip 11pt
plus2pt minus5pt\belowdisplayskip \abovedisplayskip \abovedisplayshortskip \z@
plus3pt\belowdisplayshortskip 6pt plus3pt
minus3pt\let\@listi\@listI}
%the following line was changed
\def\subsize{\@setsize\subsize{10pt}\xipt\@xipt}
\def\section{\@startsection{section}{1}{\z@}{24pt plus 2 pt
minus 2 pt} {12pt plus 2pt minus 2pt}{\large\bf}}
\def\subsection{\@startsection {subsection}{2}{\z@}{10pt
plus 2pt minus 2pt}{10pt plus 2pt minus 2pt}{\subsize\bf}}
\makeatother

\begin{document}
\date{}
\title{\Large\bf A Distributed Algorithm for 3D Radar Imaging}
\author{\begin{tabular}[t]{c}
Patrick S. Li, Simon Scott \\
Electrical Engineering and Computer Science\\
University of California, Berkeley
\end{tabular}}
\maketitle
\thispagestyle{empty}
\subsection*{\centering Abstract}
\vspace*{-3mm}
\textit{
eWallpaper is a smart wallpaper containing thousands of embedded, low-power processors and radio transceivers. An important application of the wallpaper is to use the radio transceivers to perform 3D imaging using synthetic aperture radar (SAR) techniques. The major obstacles to implementing these techniques on the wallpaper are the distribution of the data amongst the large number of processors, the restrictive 2D mesh topology and the limited local memory on each processor. Our major contribution is a distributed and memory efficient implementation of the 3D imaging algorithm that operates in realtime and achieves video framerates. A hardware simulator was built to allow rapid development and verification of eWallpaper applications. This simulator was parallelized using MPI and Pthreads, enabling fast simulation on a high-performance computing cluster. We developed a performance model and network traffic simulator to verify that our distributed algorithm meets the framerate and memory requirements when running on the actual eWallpaper hardware.
}
\section{Introduction}

eWallpaper is a smart wallpaper with thousands of low-power, RISC-V \cite{riscv} processors embedded within the paper. These processors are connected in a 2D mesh network, spaced 25mm apart. Each processor has its own radio transceiver and antenna.

One of the main objectives of the eWallpaper is to use the radio transceivers to image the room. The radios attached to each of the processors transmit millimeter-wave pulses. These pulses reflect off the objects in the room and the echoes are recorded back at the antennas. The echoes are combined using techniques borrowed from synthetic aperture radar to form a single three-dimensional image of the room.

\subsection{Applications of the eWallpaper Imaging System}

While being able to use wallpaper to form 3D images of a room is interesting, basic imaging is not the final goal of the eWallpaper. It is instead a technology that enables other high-level functions possible, such as:

\begin{itemize}
\item Gesture recognition, allowing people to control the automated functions and multimedia in their homes.
\item Monitoring of human vital signs and requesting medical assistance when, for example, a person is immobile on the floor.
\item Tracking of persons without the house for security purposes. Gurbuz et al \cite{human-recognition} describe a technique for identifying people using radar signals.
\item Creation of immersive audio fields for teleconferencing \cite{immersive-audio} that follow people as they walk around
\end{itemize}

\subsection{Challenges with Performing Realtime Imaging}

The proposed design for a single sheet of eWallpaper consists of an array of 128 x 128 antennas and processors, with each processor storing 256 echoes. These echoes are then  combined to form a three-dimensional image of room using the 3D Range Migration Algorithm \cite{3d-imaging-concealed-weapon}, which has been adapted from synthetic aperture radar (SAR) techniques. There are three key challenges to implementing this algorithm on eWallpaper:
\begin{enumerate}
\item The recorded antenna responses are distributed amongst the 128 x 128 processors. This means that the algorithm must too be distributed.
\item Moving data between processors can be expensive, due to the low-dimensional network topology (2D mesh).
\item The amount of available memory on each processor is extremely limited, on the order of 100KB. Furthermore, there is no global memory storage. This means that the echoes cannot all be sent to a single processor for computation.
\end{enumerate}

Taking these limitations into account, we developed a distributed implementation of the 3D range migration algorithm that is both memory efficient and able to achieve video framerates.

\section{The 3D Range Migration Algorithm}

The procedure for scanning the room and the technique used for forming a 3D image out of the received echoes are similar to the techniques used in seismic data processing [], synthetic aperture radar [], and microwave holography []. The basics of the procedure is presented here. For a more detailed explanation, please refer to [].

The scanning procedure starts with a single antenna emitting a continuous sinusoidal wave with angular frequency $\omega$. The sinusoidal wave reflects off the objects present in the room. A radio transceiver at the same position as the antenna will record the amplitude of the reflected sin wave, and the phase offset between the transmitted and received sin wave. The recorded signal is represented as a single complex number, $re^{j\phi}$, where the magnitude, $r$, represents the received amplitude, and $\phi$ represents the phase offset.This procedure is repeated for a number of frequencies, starting with a base frequency, $f_0$, and stepping in increments of, $\Delta f$, and for each antenna in turn. In our case, we repeat this procedure for 256 different frequencies, from 10GHz to 20GHz, and for each of the 128$\times$128 antennas. Thus the input to the imaging algorithm is a 128$\times$128$\times$256 array of amplitudes and phase offsets.

Formalizing everything, consider a single point target at $(x,y,z)$. The antennas sit at the plane $z=0$ at point $(x',y',0)$. The distance, $d$, to the from the antenna to the target is given by
\[
d=\sqrt{(x'-x)^{2}+(y'-y)^{2}+z^{2}}.
\]
The time it takes for the transmitted sin wave to travel from the antenna to the target, reflect off, and come back to the antenna is
 \[
t=\frac{2d}{c},
\]
where $c$ is the speed of light. In that time, the phase of the transmitted sin wave has advanced by
\[
\phi = \omega t,
\]
where $\omega$ is the angular frequency of the transmitted sin wave. The received sin wave at antenna position $(x',y',z=0)$ for a transmitted sin wave with angular frequency $\omega$ is then given by
\begin{gather}
s(x',y',z=0,\omega) = re^{j\phi} \\
	= re^{j \omega \frac{2}{c} \sqrt{(x'-x)^2 + (y'-y)^2 + z^2}},
\end{gather}
where $r$ is the amplitude of the received sin wave.

The recorded signal has, thus far, been described as the amplitude and phase offset resulting from a sin wave emitted from the antenna to reflect off the target and come back to the antenna. An alternative and equivalent interpretation of the received signal is of a target at $(x,y,z)$ that directly emits a sin wave of amplitude $r$, and travels at half the speed of light, $\frac{c}{2}$, and is recorded at the antenna. Under this interpretation, the scene generates a wavefield, $s(x,y,z,\omega)$, and the antennas samples the wavefield on the plane $z=0$, $s(x',y',z=0,\omega)$. 

The wavefield at depth $z$ can be recovered by propagating the recorded wavefield, $s(x',y',z=0,\omega)$, backwards in time from the antenna towards the source. This can be achieved by simply swapping the sign of the phase delay term, which represents propagation backwards in time, and summing over the contribution from each antenna.
\begin{gather}
s(x,y,z,\omega) =\int\int s(x',y',z=0,\omega) \\
e^{-j \omega \frac{2}{c} \sqrt{(x'-x)^{2}+(y'-y)^{2}+z^{2}}} dx'dy'
\end{gather}

After backwards propagation, the final 3D image can be reconstructed by integrating the expression over all frequencies.
\[
s(x,y,z)=\int s(x,y,z,\omega) d\omega.
\]

While the above algorithm is intuitive, the need to integrate over all frequencies and antenna positions for each scene position makes computation prohibitively expensive. For 128$\times$128 antennas, each emitting 256 frequencies, it took over two and a half hours on a 24 node cluster to image a room. To achieve video framerates, computations must be done in the frequency domain.

If we first pre-transform the received signal to the frequency domain, 
\[
S(k_x,k_y,z=0,\omega) = \text{FT}_{x,y} s(x, y, z=0, \omega),
\]
backward propagation can be done with a simple multiplication. 
\[
S(k_x, k_y, z, \omega) = S(k_x, k_y, z=0, \omega) e^{-j k_z z},
\]
where 
\[
k_z = \sqrt{ \frac{2 \omega}{c} ^ 2 - k_x^2 - k_y^2}.
\]
The image is reconstructed once again by integrating over the backwards propagated field over all frequencies.
\[
S(k_x, k_y, z) = \int S(k_x, k_y, z=0, \omega) e^{-j k_z z} d\omega.
\]
Finally, to avoid computing this last integral, we note that the form closely resembles an inverse Fourier transform. If we change $\omega$ to $k_z$ using linear interpolation, we can compute the integral using an efficient inverse FFT. This is called Stolt interpolation in the literature.
\[
S(k_x, k_y, z=0, \omega) \rightarrow S'(k_x, k_y, z=0, k_z)
\]

\begin{gather}
S(k_{x},k_{y},z)  =  \int S'(k_{x},k_{y},z=0,k_{z})e^{-jk_{z}z}dk_{z}\\
  =  \text{IFT}_{k_{z}}\{S'(k_{x},k_{y},z=0,k_{z})e^{-jk_{z}z_{0}}\}
\end{gather}

Thus, combining everything, the final algorithm is given as follows:
\[
s(x,y,z)=\text{IFT}_{k_{x},k_{y}}\{\text{IFT}_{k_{z}}\{\text{\text{Stolt}}\{\text{FT}_{x,y}\{s(x',y',z=0,\omega)\}\}e^{-jk_{z}z_{0}}\}\}.
\]

$s(x', y', z=0, \omega)$ is a 3d array of complex numbers with dimensions array width, by array height, by the number of frequencies. We take the 2D Fourier transform of the received signal with respect to $x$ and $y$. We then perform Stolt interpolation along the frequency axis to obtain values at evenly spaced intervals of $k_z$. Backwards propagation in the frequency domain is done by multiplying each element by a complex exponential. And finally we perform a 3D inverse Fourier transform to reconstruct the image. The reconstructed image, $s(x,y,z)$, is a 3D array whose values represent the reflectivity at each point in the room.

Also talk about:

- Three-Dimensional Millimeter-Wave Imaging for Concealed Weapon Detection

- 3-D Radar Imaging Using Range Migration Techniques

- SAR Data Focusing Using Seismic Migration Techniques

\section{Implementation on a 2D Mesh Network}

Here

- Describe wallpaper architecture and limitations in detail.
  - 128 x 128
  - mesh, as inked wires mean nearest neighbor comms only
  - Describe RISC-V performance and architecture
- Row and Column Transpose
- Explain that this is near optimal, based on 2 cited papers.
- Distributed Algorithm

\section{High Performance Functional Simulator}

To help us develop the imaging algorithm, we created a functional simulator for fast prototyping and debugging of eWallpaper applications. Applications are written in Single Program Multiple Data style. One program instance is launched per simulated wallpaper CPU. The simulation runs on an MPI cluster. Within an MPI node, virtual CPUs are simulated using Pthreads.

Wallpaper processors communicate with each other using a minimal network API which provides three basic operations:
\begin{itemize}
\item send\_message(direction, message, message\_size) sends a message with the provided message size to one of the four neighbouring processors
\item receive\_message(direction) receives a message from one of the neighbouring processors
\item set\_receive\_buffer(direction, buffer) instructs the network router to place incoming packets in the provided buffer
\end{itemize}

receive\_message blocks until there is a message waiting in the network buffer. send\_message blocks until the network router is free to send and the receiving processor has space available to hold the message. Note that send\_message returns as soon as message transmission begins, \emph{not} when message transmission is completed. Within a single MPI node, network functions are simulated using shared memory and mutexes. Across MPI node boundaries, network functions are implemented on top of MPI commands. These MPI node boundaries are invisible to the eWallpaper application.

\section{Simulated Imaging Results}

Our distributed algorithm was tested on our functional simulator running on a 64 core cluster. Antenna responses are artificially generated from an input test scene. Figure [] shows an input scene consisting of three points of varying reflectivities, the top-left point being least reflective and the bottom-right point being most reflective. Figure [] shows the reconstructed image output by our algorithm. The brightest object in the recovered image corresponds to the point with highest reflectivity. 

Figure [] shows an input scene consisting of a collection of points distributed along the surface of a sphere, and the reconstructed image is shown in Figure []. The input data for the recovered images shown in Figure [] and [] was generated from a CT scan of human head from the Stanford dataset. The recovered head is shown from two different angles.


\section{Simulated Imaging Results}

\section{Investigation of Design Parameters}
- communication patterns
- bandwidth
- array size (resolution)
- amount of precomputation
Observe:
- framerate
- cpu load
- memory

1. For this, you need a timing model. you need a traffic simulator.
2. We investigate (vary bandwidth, vary comuication, vary ..)
-- describe different communication patterns

\section{Performance Results}
3. Show the trends vs. parameters

\section{Related Work}
Although range migration originated in the field of seismic data processing, it has been extended and adapted to a variety of fields including synthetic aperture radar and microwave holography. [] extends 2D range migration for 3D imaging using millimeter waves for detecting concealed weapons and is a direct inspiration for our work. In place of a 2D array of antennas, their system uses a scanned linear array of antennas and forms images at the rate of 1-2s per frame.

- Three-Dimensional Millimeter-Wave Imaging for Concealed Weapon Detection
- 3-D Radar Imaging Using Range Migration Techniques
- SAR Data Focusing Using Seismic Migration Techniques

- concealed weapons
- original SAR paper
- near-field 3D SAR imaging
- realtime through-wall imaging
- FFT's on ring topologies

- Applications: heart rate monitoring for Olympics

\section{Conclusion}
- Conclude.
- Future Work.

\subsection*{Acknowledgements}
SWARM lab?
Kurt?


{\small
\bibliographystyle{IEEEtran}
\bibliography{bib}
}

\end{document}
